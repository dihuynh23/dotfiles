# Change prefix from Ctrl-b to Ctrl-a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Prompt for window name on creation
set-window-option -g automatic-rename off
set-option -g allow-rename off
bind-key C command-prompt -p "Window name:" "new-window; rename-window '%%'"

# Prompt for changing pane title 
bind-key T command-prompt -p "Pane title:" "select-pane -T '%%'"

# New panes open in the same directory as the current pane
bind '"' split-window -c "#{pane_current_path}"
bind '%' split-window -h -c "#{pane_current_path}"

# Enable mouse support
set -g mouse on

# Start windows/panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Cycle windows with Ctrl-n (no prefix needed)
bind -n C-n next-window

# Switch to last window with Ctrl-p (alt-tab style, no prefix needed)
bind -n C-p last-window

# Reload config with prefix + r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded"

# Vi-style keys in copy mode (scroll mode)
setw -g mode-keys vi

# Faster escape time
set -sg escape-time 0

# Increase history limit
set -g history-limit 10000

# Copy to system clipboard on mouse selection or vi yank
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "xclip -selection clipboard"
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard"

# Enable notification
set -g visual-bell off
set -g bell-action any

# Allow passthrough for kitty notifications
set -g allow-passthrough on

# Smart pane switching with awareness of Vim splits
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
bind-key -n 'C-\' if-shell "$is_vim" 'send-keys C-\\'  'select-pane -l'

# Clear terminal (prefix + C-l) since bare C-l is used for pane switching
bind C-l send-keys C-l

# Pane border styling - rose pink from kitty 1989 theme
set -g pane-border-lines heavy
set -g pane-border-style fg=#444444
set -g pane-active-border-style fg=#f591b2

# Active window in status bar - rose pink to match active pane border
set -g window-status-current-style bold
set -g window-status-bell-style fg=#ffff00,bg=#ff69b4,bold

# Pane status bar - shows pane index, command, title (for claude), and path
set -g pane-border-status top
set -g pane-border-format ' #[fg=#f591b2]#{pane_index}#[default] #{pane_current_command}#{?#{==:#{pane_current_command},claude}, Â· #{pane_title},} #[fg=#878787]#{b:pane_current_path}#[default] '
